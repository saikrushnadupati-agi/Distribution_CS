----------------------------------------------------------------------------------------------------
--             Copyright Â© 40000-2020 PharmApps, LLc.                				  			  --
--             All Rights Reserved.								 							      --
--             This software is the confidential and proprietary information of PharmApps,LLC.	  --
--             (Confidential Information).														  --
----------------------------------------------------------------------------------------------------
-- CREATED BY           : SANJAY KU. BEHERA                                            	          --
-- FILENAME             : dist_temp_table_decode_script			    				              --
-- PURPOSE              : This Script is for mapping of distribution rule  from code to decode    --
-- DATE CREATED         : 23/03/2022                   						                      --
-- OBJECT LIST          :                                                                         --
-- MODIFIED BY 		    : Sai Krushna Dupati /Navya Chandramouli															  --
-- DATE MODIFIED		: 09-SEP-2025                       						              --
-- REVIEWD BY           : DEBASIS DAS                                                             --
-- ********************************************************************************************** --



DO $$
DECLARE 
Lv_string TEXT;
Lv_string1 TEXT;
l_context TEXT;
BEGIN

SELECT STRING_AGG(COLUMN_NAME,'') INTO Lv_string
FROM 
(SELECT 'CREATE TABLE C_DISTRIBUTION_RULES_CODE
(SL_NO VARCHAR(4000),CONTACT_NAME  VARCHAR(4000),FORMAT VARCHAR(4000),DISPLAY_NAME VARCHAR(4000),RULE_ACTIVE VARCHAR(4000),DATA_PRIVACY VARCHAR(4000), RELEASE VARCHAR(4000)
,TIME_LINE_DAY VARCHAR(4000),RULE_INCLUSION VARCHAR(4000),PIVOT_NAME VARCHAR(4000),PIVOT_VALUE VARCHAR(4000),PIVOT_RULE VARCHAR(4000),CONTACT_LEVEL_PIVOT  VARCHAR(40000),contact_level_pivot_ex VARCHAR(40000),contact_level_pivot_val VARCHAR(40000), FORMAT_LEVEL_PIVOT  VARCHAR(40000),
FORMAT_LEVEL_PIVOT_ex  VARCHAR(40000),FORMAT_LEVEL_PIVOT_VAL  VARCHAR(40000),ANCHOR_LEVEL_PIVOT  VARCHAR(40000),ANCHOR_LEVEL_PIVOT_EX  VARCHAR(40000),ANCHOR_LEVEL_PIVOT_VAL  VARCHAR(40000)
,RULE_SEQUENCE VARCHAR(4000),REPORT_TYPE VARCHAR(4000),FINAL_EXPRESSION VARCHAR(4000),Timeline_1 VARCHAR(4000),TL1_PARAM VARCHAR(4000),TL1_DAY VARCHAR(4000),Timeline_2 VARCHAR(4000),TL2_PARAM VARCHAR(4000),TL2_DAY VARCHAR(4000),Timeline_3 VARCHAR(4000),
TL3_PARAM VARCHAR(4000),TL3_DAY VARCHAR(4000),Timeline_4 VARCHAR(4000),TL4_PARAM VARCHAR(4000),TL4_DAY VARCHAR(4000),DEFAULT_TIMELINE_DAYS VARCHAR(4000),format_display_name VARCHAR(4000), OLT VARCHAR(4000),' COLUMN_NAME FROM DUAL
UNION ALL
SELECT STRING_AGG(COLUMN_NAME,'') FROM 
(SELECT REPLACE(TTT,'-','')||' VARCHAR(400),' COLUMN_NAME FROM (
select CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 'I_' ELSE 'U_' END|| 
REPLACE(REPLACE(SUBSTRING(SUBSTRING(RULE_NAME,CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 5 ELSE 1 END,40),1,15),' ','_')||'_'||RULE_ID,'__','_') TTT 
from LSMV_RULE_DETAILS WHERE ACTIVE_YN = 'Y' AND MODULE_NAME = 'Distribution'
--Below condition added by Swathi
and rule_id not like '%DR065%'
and RULE_ID not in ('CR001')) a ORDER BY TTT) b
UNION ALL
SELECT STRING_AGG(COLUMN_NAME,'') FROM(
SELECT TTT||'_EX'||' VARCHAR(400),' COLUMN_NAME FROM (
select CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 'I_' ELSE 'U_' END|| 
REPLACE(REPLACE(SUBSTRING(SUBSTRING(RULE_NAME,CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 5 ELSE 1 END,40),1,15),' ','_')||'_'||RULE_ID,'__','_') TTT 
from LSMV_RULE_DETAILS  WHERE EXCLUDABLE_RULE = 'Y' AND ACTIVE_YN = 'Y' AND MODULE_NAME = 'Distribution'
--Below condition added by Swathi
and rule_id not like '%DR065%'
and RULE_ID not in ('CR001')
) a  ORDER BY TTT) b
UNION ALL
(SELECT STRING_AGG(COLUMN_NAME,'') FROM(
SELECT TTT||'_VAL'||' VARCHAR(4000),' COLUMN_NAME FROM (
select CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 'I_' ELSE 'U_' END|| 
REPLACE(REPLACE(SUBSTR(SUBSTR(RULE_NAME,CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 5 ELSE 1 END,40),1,15),' ','_')||'_'||RULE_ID,'__','_') TTT 
from LSMV_RULE_DETAILS  
	WHERE RULE_PARAM_MAP <> '{"adhocRules":[],"paramMap":{}}' 
	and RULE_PARAM_MAP <> '{"SMQCMQ_LIST":"","adhocRules":[],"paramMap":{}}'
	AND (UPPER(RULE_PARAM_MAP) LIKE '%LIB_%' OR UPPER(RULE_PARAM_MAP) LIKE '%CL_%')
AND RULE_ID NOT LIKE '%/_%' ESCAPE '/'
AND ACTIVE_YN = 'Y' AND MODULE_NAME = 'Distribution'
--Below condition added by Swathi
and rule_id not like '%DR065%'
and RULE_ID not in ('CR001')) a ORDER BY TTT
)a )) T ;

 Lv_string := RTRIM(Lv_string,',')||')';
 
EXECUTE 'DROP TABLE IF EXISTS C_DISTRIBUTION_RULES_code';
 --Lv_string := 'SELECT 1 FROM DUAL';
EXECUTE  Lv_string;
 
--RAISE NOTICE 'EXCEPTION%', Lv_string;
EXCEPTION
WHEN NO_DATA_FOUND THEN
RAISE NOTICE 'EXCEPTION%', 'NO DATA FOUND';
WHEN others THEN
GET STACKED DIAGNOSTICS l_context = PG_EXCEPTION_CONTEXT;
RAISE NOTICE 'EXCEPTION%', l_context;
END $$;




DO $$
DECLARE 
Lv_string TEXT;
Lv_string1 TEXT;
l_context TEXT;
BEGIN

SELECT STRING_AGG(COLUMN_NAME,'') INTO Lv_string
FROM 
(SELECT 'CREATE TABLE C_DISTRIBUTION_RULES_decode
(SL_NO VARCHAR(4000),CONTACT_NAME  VARCHAR(4000),FORMAT VARCHAR(4000),DISPLAY_NAME VARCHAR(4000),RULE_ACTIVE VARCHAR(4000),DATA_PRIVACY VARCHAR(4000), RELEASE VARCHAR(4000)
,TIME_LINE_DAY VARCHAR(4000),RULE_INCLUSION VARCHAR(4000),PIVOT_NAME VARCHAR(4000),PIVOT_VALUE VARCHAR(4000),PIVOT_RULE VARCHAR(4000),CONTACT_LEVEL_PIVOT  VARCHAR(40000),contact_level_pivot_ex VARCHAR(40000),contact_level_pivot_val VARCHAR(40000),FORMAT_LEVEL_PIVOT  VARCHAR(40000)
,FORMAT_LEVEL_PIVOT_ex  VARCHAR(40000),FORMAT_LEVEL_PIVOT_VAL  VARCHAR(40000),ANCHOR_LEVEL_PIVOT  VARCHAR(40000),ANCHOR_LEVEL_PIVOT_EX  VARCHAR(40000),ANCHOR_LEVEL_PIVOT_VAL  VARCHAR(40000)
,RULE_SEQUENCE VARCHAR(4000),REPORT_TYPE VARCHAR(4000),FINAL_EXPRESSION VARCHAR(4000),Timeline_1 VARCHAR(4000),TL1_PARAM VARCHAR(4000),TL1_DAY VARCHAR(4000),Timeline_2 VARCHAR(4000),TL2_PARAM VARCHAR(4000),TL2_DAY VARCHAR(4000),Timeline_3 VARCHAR(4000),
TL3_PARAM VARCHAR(4000),TL3_DAY VARCHAR(4000),Timeline_4 VARCHAR(4000),TL4_PARAM VARCHAR(4000),TL4_DAY VARCHAR(4000),DEFAULT_TIMELINE_DAYS VARCHAR(4000),format_display_name VARCHAR(4000), OLT VARCHAR(4000),' COLUMN_NAME FROM DUAL
UNION ALL
SELECT STRING_AGG(COLUMN_NAME,'') FROM 
(SELECT REPLACE(TTT,'-','')||' VARCHAR(400),' COLUMN_NAME FROM (
select CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 'I_' ELSE 'U_' END|| 
REPLACE(REPLACE(SUBSTRING(SUBSTRING(RULE_NAME,CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 5 ELSE 1 END,40),1,15),' ','_')||'_'||RULE_ID,'__','_') TTT 
from LSMV_RULE_DETAILS WHERE ACTIVE_YN = 'Y' AND MODULE_NAME = 'Distribution' 
--Below condition added by Swathi
and rule_id not like '%DR065%'
and RULE_ID not in ('CR001')) a ORDER BY TTT) b
UNION ALL
SELECT STRING_AGG(COLUMN_NAME,'') FROM(
SELECT TTT||'_EX'||' VARCHAR(400),' COLUMN_NAME FROM (
select CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 'I_' ELSE 'U_' END|| 
REPLACE(REPLACE(SUBSTRING(SUBSTRING(RULE_NAME,CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 5 ELSE 1 END,40),1,15),' ','_')||'_'||RULE_ID,'__','_') TTT 
from LSMV_RULE_DETAILS  WHERE EXCLUDABLE_RULE = 'Y' AND ACTIVE_YN = 'Y' AND MODULE_NAME = 'Distribution'
--Below condition added by Swathi
and rule_id not like '%DR065%'
and RULE_ID not in ('CR001')
) a  ORDER BY TTT) b
UNION ALL
(SELECT STRING_AGG(COLUMN_NAME,'') FROM(
SELECT TTT||'_VAL'||' VARCHAR(4000),' COLUMN_NAME FROM (
select CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 'I_' ELSE 'U_' END|| 
REPLACE(REPLACE(SUBSTR(SUBSTR(RULE_NAME,CASE  WHEN RULE_NAME LIKE 'ISP%' THEN 5 ELSE 1 END,40),1,15),' ','_')||'_'||RULE_ID,'__','_') TTT 
from LSMV_RULE_DETAILS  
	WHERE RULE_PARAM_MAP <> '{"adhocRules":[],"paramMap":{}}' 
	and RULE_PARAM_MAP <> '{"SMQCMQ_LIST":"","adhocRules":[],"paramMap":{}}'
	AND (UPPER(RULE_PARAM_MAP) LIKE '%LIB_%' OR UPPER(RULE_PARAM_MAP) LIKE '%CL_%')
AND RULE_ID NOT LIKE '%/_%' ESCAPE '/'
AND ACTIVE_YN = 'Y' AND MODULE_NAME = 'Distribution'
--Below condition added by Swathi
and rule_id not like '%DR065%'
and RULE_ID not in ('CR001')) a ORDER BY TTT
)a )) T ;

 Lv_string := RTRIM(Lv_string,',')||')';
 
EXECUTE 'DROP TABLE IF EXISTS C_DISTRIBUTION_RULES_decode';
 --Lv_string := 'SELECT 1 FROM DUAL';
EXECUTE  Lv_string;
 
--RAISE NOTICE 'EXCEPTION%', Lv_string;
EXCEPTION
WHEN NO_DATA_FOUND THEN
RAISE NOTICE 'EXCEPTION%', 'NO DATA FOUND';
WHEN others THEN
GET STACKED DIAGNOSTICS l_context = PG_EXCEPTION_CONTEXT;
RAISE NOTICE 'EXCEPTION%', l_context;
END $$;

--------------------------------------------------------------------------------

insert into C_DISTRIBUTION_RULES_DECODE(SL_NO,CONTACT_NAME,FORMAT,FORMAT_DISPLAY_NAME,DISPLAY_NAME,RULE_INCLUSION,RULE_SEQUENCE,PIVOT_NAME,REPORT_TYPE,TIME_LINE_DAY,FINAL_EXPRESSION,
CONTACT_LEVEL_PIVOT, CONTACT_LEVEL_PIVOT_EX, CONTACT_LEVEL_PIVOT_VAL, FORMAT_LEVEL_PIVOT, FORMAT_LEVEL_PIVOT_EX, FORMAT_LEVEL_PIVOT_VAL, ANCHOR_LEVEL_PIVOT, 
ANCHOR_LEVEL_PIVOT_EX, ANCHOR_LEVEL_PIVOT_VAL,
I_COUNTRY_OF_DETE_DR001	,
I_COUNTRY_OF_DETE_DR001_VAL	,
I_COUNTRY_OF_DETE_DR001_EX	,
I_PROTOCOL_NO_DR003	,
I_PROTOCOL_NO_DR003_VAL	,
I_PROTOCOL_NO_DR003_EX	,
I_MEDICALLY_CONFI_DR004	,
I_MEDICALLY_CONFI_DR004_EX	,
I_STUDY_TYPE_DR010	,
I_STUDY_TYPE_DR010_EX	,
I_STUDY_TYPE_DR010_VAL	,
I_CODEBROKEN_DR015	,
I_CODEBROKEN_DR015_EX	,
I_CODEBROKEN_DR015_VAL	,
I_IDENTIFIABLE_PA_DR018	,
I_IDENTIFIABLE_PA_DR018_EX	,
I_CASE_SIGNIFICAN_DR022	,
I_CASE_SIGNIFICAN_DR022_EX	,
I_CASE_SIGNIFICAN_DR022_Val	,
I_SENDER_ORGANIZA_DR024	,
I_SENDER_ORGANIZA_DR024_VAL	,
I_SENDER_ORGANIZA_DR024_EX	,
I_SOURCE_DR026	,
I_SOURCE_DR026_EX	,
I_SOURCE_DR026_VAL	,
I_REPORT_TYPE_DR027	,
I_REPORT_TYPE_DR027_EX	,
I_REPORT_TYPE_DR027_VAL	,
I_PRODUCT_DR032	,
I_PRODUCT_DR032_EX	,
I_PRODUCT_DR032_VAL	,
I_AESI_DR034,
I_STUDY_PRODUCT_T_DR035	,
I_STUDY_PRODUCT_T_DR035_VAL	,
I_STUDY_PRODUCT_T_DR035_EX	,
I_PRODUCT_APPROVA_DR044	,
I_PRODUCT_APPROVA_DR044_EX	,
I_PRODUCT_APPROVA_DR044_VAL	,
I_LITERATURE_REFE_DR049	,
I_LITERATURE_REFE_DR049_EX	,
I_MALFUNCTION_DR051	,
I_MALFUNCTION_DR051_VAL	,
I_REPORT_CLASSIFI_DR053	,
I_REPORT_CLASSIFI_DR053_EX,
I_REPORT_CLASSIFI_DR053_VAL,
I_STUDY_PHASE_DR056	,
I_STUDY_PHASE_DR056_EX	,
I_STUDY_PHASE_DR056_VAL	,
I_STUDY_SPONSOR_DR059	,
I_STUDY_SPONSOR_DR059_EX	,
I_STUDY_SPONSOR_DR059_VAL	,
I_STUDY_REGISTRAT_DR063	,
I_STUDY_REGISTRAT_DR063_EX	,
I_STUDY_REGISTRAT_DR063_VAL	,
U_USER_IMPLIED_CA_DR5001	,
U_USER_IMPLIED_CA_DR5001_VAL	,
U_USER_PRODUCT_EV_DR5012	,
U_USER_PRODUCT_EV_DR5012_VAL	,
U_USER_SPHT_DR5002	,
U_USER_RETRO_SURV_DR5062	,
U_USER_RETRO_SURV_DR5062_EX	,
U_USER_COUNTRY_PU_DR5063	,
U_USER_COUNTRY_PU_DR5063_Ex	,
U_USER_CLINICAL_C_DR5064	,
U_USER_CLINICAL_C_DR5064_Ex	,
U_USER_SCRIPTED_M_DR5008	,
U_USER_SCRIPTED_M_DR5008_VAL	,
U_USER_DEVICE_MAT_DR5019	,
U_USER_DEVICE_MAT_DR5019_VAL	,
U_USER_PMDA_DEVIC_DR5020	,
U_USER_PMDA_DEVIC_DR5020_VAL	,
U_USER_PMDA_DEVIC_DR5021	,
U_USER_PMDA_DEVIC_DR5021_VAL	,
U_USER_MANUAL_SUB_DR5065	,
U_USER_MANUAL_SUB_DR5065_EX	,
U_USER_REPORTER_S_DR5013,
U_USER_REPORTER_S_DR5013_EX,
U_USER_REPORTER_S_DR5013_VAL,
U_USER_PAT_REP_CO_DR5025,
U_USER_PAT_REP_CO_DR5025_VAL,
U_USER_FATAL_ADVR_DR5014,
U_USER_FATAL_ADVR_DR5014_VAL,
U_USER_STUDY_CODE_DR5015,
U_USER_STUDY_CODE_DR5015_EX,
U_USER_STUDY_CODE_DR5015_VAL,
U_USER_SENDER_ORG_DR5017,
U_USER_SENDER_ORG_DR5017_EX,
U_USER_SPONCER_TY_DR5016,
U_USER_SPONCER_TY_DR5016_EX,
U_USER_SPONCER_TY_DR5016_VAL,


Timeline_1, TL1_DAY, Timeline_2, TL2_DAY, Timeline_3, TL3_DAY, DEFAULT_TIMELINE_DAYS
)
SELECT SL_NO,distribution_contact_name CONTACT_NAME,FORMAT,FORMAT_DISPLAY_NAME,anchor_name DISPLAY_NAME,
inclusion_logic RULE_INCLUSION,rank RULE_SEQUENCE,PIVOT PIVOT_NAME,REPORT_TYPE,time_line TIME_LINE_DAY,
FINAL_EXPRESSION,CONTACT_LEVEL_PIVOT, CONTACT_LEVEL_PIVOT_EX, CONTACT_LEVEL_PIVOT_VAL, FORMAT_LEVEL_PIVOT, FORMAT_LEVEL_PIVOT_EX, FORMAT_LEVEL_PIVOT_VAL, ANCHOR_LEVEL_PIVOT, 
ANCHOR_LEVEL_PIVOT_EX, ANCHOR_LEVEL_PIVOT_VAL, 
I_COUNTRY_OF_DETE_DR001	,
I_COUNTRY_OF_DETE_DR001_VAL	,
I_COUNTRY_OF_DETE_DR001_EX	,
I_PROTOCOL_NO_DR003	,
I_PROTOCOL_NO_DR003_VAL	,
I_PROTOCOL_NO_DR003_EX	,
I_MEDICALLY_CONFI_DR004	,
I_MEDICALLY_CONFI_DR004_EX	,
I_STUDY_TYPE_DR010	,
I_STUDY_TYPE_DR010_EX	,
I_STUDY_TYPE_DR010_VAL	,
I_CODEBROKEN_DR015	,
I_CODEBROKEN_DR015_EX	,
I_CODEBROKEN_DR015_VAL	,
I_IDENTIFIABLE_PA_DR018	,
I_IDENTIFIABLE_PA_DR018_EX	,
I_CASE_SIGNIFICAN_DR022	,
I_CASE_SIGNIFICAN_DR022_EX	,
I_CASE_SIGNIFICAN_DR022_Val	,
I_SENDER_ORGANIZA_DR024	,
I_SENDER_ORGANIZA_DR024_VAL	,
I_SENDER_ORGANIZA_DR024_EX	,
I_SOURCE_DR026	,
I_SOURCE_DR026_EX	,
I_SOURCE_DR026_VAL	,
I_REPORT_TYPE_DR027	,
I_REPORT_TYPE_DR027_EX	,
I_REPORT_TYPE_DR027_VAL	,
I_PRODUCT_DR032	,
I_PRODUCT_DR032_EX	,
I_PRODUCT_DR032_VAL	,
I_AESI_DR034,
I_STUDY_PRODUCT_T_DR035	,
I_STUDY_PRODUCT_T_DR035_VAL	,
I_STUDY_PRODUCT_T_DR035_EX	,
I_PRODUCT_APPROVA_DR044	,
I_PRODUCT_APPROVA_DR044_EX	,
I_PRODUCT_APPROVA_DR044_VAL	,
I_LITERATURE_REFE_DR049	,
I_LITERATURE_REFE_DR049_EX	,
I_MALFUNCTION_DR051	,
I_MALFUNCTION_DR051_VAL	,
I_REPORT_CLASSIFI_DR053	,
I_REPORT_CLASSIFI_DR053_EX,
I_REPORT_CLASSIFI_DR053_VAL,
I_STUDY_PHASE_DR056	,
I_STUDY_PHASE_DR056_EX	,
I_STUDY_PHASE_DR056_VAL	,
I_STUDY_SPONSOR_DR059	,
I_STUDY_SPONSOR_DR059_EX	,
I_STUDY_SPONSOR_DR059_VAL	,
I_STUDY_REGISTRAT_DR063	,
I_STUDY_REGISTRAT_DR063_EX	,
I_STUDY_REGISTRAT_DR063_VAL	,
U_USER_IMPLIED_CA_DR5001	,
U_USER_IMPLIED_CA_DR5001_VAL	,
U_USER_PRODUCT_EV_DR5012	,
U_USER_PRODUCT_EV_DR5012_VAL	,
U_USER_SPHT_DR5002	,
U_USER_RETRO_SURV_DR5062	,
U_USER_RETRO_SURV_DR5062_EX	,
U_USER_COUNTRY_PU_DR5063	,
U_USER_COUNTRY_PU_DR5063_Ex	,
U_USER_CLINICAL_C_DR5064	,
U_USER_CLINICAL_C_DR5064_Ex	,
U_USER_SCRIPTED_M_DR5008	,
U_USER_SCRIPTED_M_DR5008_VAL	,
U_USER_DEVICE_MAT_DR5019	,
U_USER_DEVICE_MAT_DR5019_VAL	,
U_USER_PMDA_DEVIC_DR5020	,
U_USER_PMDA_DEVIC_DR5020_VAL	,
U_USER_PMDA_DEVIC_DR5021	,
U_USER_PMDA_DEVIC_DR5021_VAL	,
U_USER_MANUAL_SUB_DR5065	,
U_USER_MANUAL_SUB_DR5065_EX	,
U_USER_REPORTER_S_DR5013,
U_USER_REPORTER_S_DR5013_EX,
U_USER_REPORTER_S_DR5013_VAL,
U_USER_PAT_REP_CO_DR5025,
U_USER_PAT_REP_CO_DR5025_VAL,
U_USER_FATAL_ADVR_DR5014,
U_USER_FATAL_ADVR_DR5014_VAL,
U_USER_STUDY_CODE_DR5015,
U_USER_STUDY_CODE_DR5015_EX,
U_USER_STUDY_CODE_DR5015_VAL,
U_USER_SENDER_ORG_DR5017,
U_USER_SENDER_ORG_DR5017_EX,
U_USER_SPONCER_TY_DR5016,
U_USER_SPONCER_TY_DR5016_EX,
U_USER_SPONCER_TY_DR5016_VAL,
Timeline_1, TL1_DAY, Timeline_2, TL2_DAY, Timeline_3, TL3_DAY, DEFAULT_TIMELINE_DAYS  from lsmv_temp_upload
where final_expression is not null or final_expression <> '';

--------------------------------------------------------------------------------





-- CREATEING TABLE C_DISTRIBUTION_RULES_CODE TAMP TABLE TO STORE THE MAPPED DATA 
						
DROP TABLE IF EXISTS C_USER_TAB_COLUMNS;
						
CREATE TABLE C_USER_TAB_COLUMNS AS
select TABLE_NAME, COLUMN_NAME, DATA_TYPE from information_schema.columns 
where UPPER(table_name) = UPPER('C_DISTRIBUTION_RULES_CODE');		






Do $$
DECLARE
l_context TEXT;
I RECORD;
SL_UPDT RECORD;
Lv_column_name VARCHAR(4000);
LV_EXE_STRING VARCHAR(340000);
BEGIN

	 FOR SL_UPDT IN (select contact_name,FORMAT,DISPLAY_NAME, row_number() 
						OVER (ORDER BY contact_name,FORMAT,DISPLAY_NAME) as rownum  from C_DISTRIBUTION_RULES_DECODE
					)
	 LOOP 
	 
	 	 UPDATE C_DISTRIBUTION_RULES_DECODE 
		 SET SL_NO = SL_UPDT.rownum
		 WHERE contact_name = SL_UPDT.contact_name
		 AND FORMAT = SL_UPDT.FORMAT
		 AND DISPLAY_NAME = SL_UPDT.DISPLAY_NAME;
		 
	  END LOOP;
	 

 		FOR I IN (SELECT COLUMN_NAME FROM C_USER_TAB_COLUMNS 
				  WHERE TABLE_NAME = LOWER('C_DISTRIBUTION_RULES_CODE')
				  AND UPPER(COLUMN_NAME) NOT IN ('CONTACT_NAME')
				 ) 
 		LOOP
 	 		Lv_column_name := I.COLUMN_NAME;
			
			LV_EXE_STRING := 'UPDATE C_DISTRIBUTION_RULES_DECODE SET '||Lv_column_name
							 ||' =  REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(TRIM('||Lv_column_name
||'),''/ '' ,''/''),'' /'',''/''),'': '' ,'':''),'' :'','':''),'', '' ,'',''),'' ,'','',''),CHR(10),''''),CHR(13),''''),CHR(9),''''),''    '','' ''),''   '','' ''),''  '','' ''),''^ '' ,''^''),'' ^'',''^'') ';
			
			
			EXECUTE  LV_EXE_STRING;
			--RAISE NOTICE 'O: %',LV_EXE_STRING;
			
	
 		END LOOP;
 
EXCEPTION 
WHEN others THEN
GET STACKED DIAGNOSTICS l_context = PG_EXCEPTION_CONTEXT;
RAISE NOTICE 'EXCEPTION%', l_context;
END $$;
